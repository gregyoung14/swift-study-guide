# Concurrency (Grand Central Dispatch, Operations, async/await)

## Overview
This section explores concurrency in Swift, covering essential tools and paradigms for writing code that performs multiple tasks simultaneously. We will delve into Grand Central Dispatch (GCD), OperationQueues, and the modern async/await syntax, enabling you to build responsive and efficient iOS applications that handle complex asynchronous operations effectively.

## Table of Contents

- [Introduction to Concurrency](#introduction-to-concurrency)
    - [What is Concurrency? (Parallelism vs. Concurrency)](#what-is-concurrency-parallelism-vs-concurrency)
    - [Why Concurrency is Important in iOS Development (Responsive UI, Background Tasks)](#why-concurrency-is-important-in-ios-development-responsive-ui-background-tasks)
    - [Challenges of Concurrency (Race Conditions, Deadlocks, Priority Inversion, Starvation)](#challenges-of-concurrency-race-conditions-deadlocks-priority-inversion-starvation)
- [Grand Central Dispatch (GCD)](#grand-central-dispatch-gcd)
    - [Dispatch Queues](#dispatch-queues)
        - [Serial Queues (FIFO, Guarantees Order)](#serial-queues-fifo-guarantees-order)
        - [Concurrent Queues (Execute Tasks in Parallel)](#concurrent-queues-execute-tasks-in-parallel)
        - [Main Queue (UI Updates, Serial)](#main-queue-ui-updates-serial)
        - [Global Queues (System-Provided, Concurrent)](#global-queues-system-provided-concurrent)
        - [Creating Custom Queues](#creating-custom-queues)
    - [Asynchronous vs. Synchronous Tasks](#asynchronous-vs-synchronous-tasks)
        - [`dispatch_async` (Non-Blocking)](#dispatch_async-non-blocking)
        - [`dispatch_sync` (Blocking)](#dispatch_sync-blocking)
        - [When to use `async` vs `sync`](#when-to-use-async-vs-sync)
    - [DispatchWorkItem](#dispatchworkitem)
        - [Creating and Executing Work Items](#creating-and-executing-work-items)
        - [Cancelling Work Items](#cancelling-work-items)
    - [DispatchGroup](#dispatchgroup)
        - [Notifying Completion of Multiple Tasks](#notifying-completion-of-multiple-tasks)
        - [Waiting for Tasks to Complete (`wait()`)](#waiting-for-tasks-to-complete-wait)
    - [DispatchBarrier](#dispatchbarrier)
        - [Concurrent Reads, Single Write Pattern](#concurrent-reads-single-write-pattern)
        - [Creating a Barrier Queue](#creating-a-barrier-queue)
    - [DispatchSemaphore](#dispatchsemaphore)
        - [Controlling Access to Limited Resources](#controlling-access-to-limited-resources)
        - [`signal()` and `wait()`](#signal-and-wait)
    - [Quality of Service (QoS)](#quality-of-service-qos)
        - [UserInteractive, UserInitiated, Utility, Background (Priorities)](#userinteractive-userinitiated-utility-background-priorities)
        - [Specifying QoS Levels](#specifying-qos-levels)
- [OperationQueues and Operations](#operationqueues-and-operations)
    - [`Operation` Class](#operation-class)
        - [Custom Operations (Subclassing `Operation`)](#custom-operations-subclassing-operation)
        - [State Management (`isExecuting`, `isFinished`)](#state-management-isexecuting-isfinished)
        - [Cancellation and `isCancelled`](#cancellation-and-iscancelled)
    - [`BlockOperation`](#blockoperation)
    - [`OperationQueue` Class](#operationqueue-class)
        - [Adding Operations to a Queue](#adding-operations-to-a-queue)
        - [Max Concurrent Operation Count (Throttling)](#max-concurrent-operation-count-throttling)
        - [Dependencies Between Operations (`addDependency`)](#dependencies-between-operations-adddependency)
        - [Cancelling All Operations](#cancelling-all-operations)
    - [Relationship to GCD (Built on Top of GCD)](#relationship-to-gcd-built-on-top-of-gcd)
    - [When to use OperationQueues vs. GCD](#when-to-use-operationqueues-vs-gcd)
- [Structured Concurrency (`async/await`)](#structured-concurrency-asyncawait)
    - [Introduction to `async/await` (Modern Swift Concurrency)](#introduction-to-asyncawait-modern-swift-concurrency)
    - [Asynchronous Functions (`async` keyword)](#asynchronous-functions-async-keyword)
    - [Awaiting Asynchronous Code (`await` keyword)](#awaiting-asynchronous-code-await-keyword)
    - [Tasks and Task Groups](#tasks-and-task-groups)
        - [Creating Tasks (`Task { ... }`)](#creating-tasks-task)
        - [Unstructured Concurrency (Detached Tasks)](#unstructured-concurrency-detached-tasks)
        - [Task Groups (`withTaskGroup`) (Dynamic Task Creation)](#task-groups-withtaskgroup-dynamic-task-creation)
        - [Structured Concurrency Benefits (Error Propagation, Cancellation)](#structured-concurrency-benefits-error-propagation-cancellation)
    - [Actors (Reference Types for Isolated Mutable State)](#actors-reference-types-for-isolated-mutable-state)
        - [Solving Data Races and Mutual Exclusion](#solving-data-races-and-mutual-exclusion)
        - [Actor Isolation and Reentrancy](#actor-isolation-and-reentrancy)
        - [Global Actors (`@MainActor`)](#global-actors-mainactor)
    - [Sendable and `@Sendable` Closures](#sendable-and-sendable-closures)
        - [Ensuring Type Safety Across Concurrency Domains](#ensuring-type-safety-across-concurrency-domains)
        - [Value vs. Reference Types with Sendable](#value-vs-reference-types-with-sendable)
    - [MainActor (`@MainActor`)](#mainactor-mainactor)
        - [Performing UI Updates on the Main Thread](#performing-ui-updates-on-the-main-thread)
        - [Marking Classes/Functions as MainActor-Isolated](#marking-classesfunctions-as-mainactor-isolated)
- [Best Practices for Concurrency](#best-practices-for-concurrency)
    - [Avoiding Race Conditions (Locks, Semaphores, Actors)](#avoiding-race-conditions-locks-semaphores-actors)
    - [Preventing Deadlocks (Careful Resource Management)](#preventing-deadlocks-careful-resource-management)
    - [Error Handling in Concurrent Code](#error-handling-in-concurrent-code)
    - [Testing Concurrent Code (XCTest Expectations, `XCTWaiter`)](#testing-concurrent-code-xctest-expectations-xctwaiter)
    - [Choosing the Right Concurrency Model (GCD vs. Operations vs. async/await)](#choosing-the-right-concurrency-model-gcd-vs-operations-vs-asyncawait)
    - [Managing Thread Explosion](#managing-thread-explosion)
